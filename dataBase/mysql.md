# Mysql

## 存储引擎

### innodb

1. 在InnoDB存储引擎中，也有页的概念，默认每个页的大小为16K，也就是每次读取数据时都是读取4*4k的大小！
2. 所以在某一个页内的数据并不是完全有序的
   1. 在某个页内插入新行时，为了不减少数据的移动，通常是插入到当前行的后面或者是已删除行留下来的空间 
3. 数据比较少时，一个页就能容下，所以只有一个根结点，主键和数据也都是保存在根结点
4. 数据多时，这时候就需要进行页分裂，产生一个新的Page
   1. 产生新的Page2，然后将Page1的内容复制到Page2
5. 为什么复制
   1. 如果是重新创建根结点，那根结点存储的物理地址可能经常会变，不利于查找。并且在innodb中根结点是会预读到内存中的，所以结点的物理地址固定会比较好
6. 增加数据时对b树进行了修改优化
   1. 使用原有模式，这样的话新的页空间利用率只有50%，并且会导致更为频繁的页分裂。
   2. 所以innodb对这一点做了优化，新的数据放入新创建的页，不移动原有页面的任何记录。
7. 为什么在innodb中建议设置主键自增的原因
   1. 主键自增写入时新插入的数据不会影响到原有页，插入效率高！且页的利用率高！
   2. 主键是无序的或者随机的，那每次的插入可能会导致原有页频繁的分裂，影响插入效率！降低页的利用率！
8. 频繁插入删除，会产生碎片，页的空间利用率低，还会导致树变的“虚高”，降低查询效率！这可以通过索引重建来消除碎片提高查询效率

### myisam

1. 主键索引树的叶子结点的数据区域没有存放实际的数据，存放的是数据记录的地址。
2. 数据的存储不是按主键顺序存放的，按写入的顺序存放
3. innodb引擎数据在物理上是按主键顺序存放，而MyISAM引擎数据在物理上按插入的顺序存放。
4. 非聚集索引的存储结构与聚集索引类似，在使用非聚集索引查找数据的时候通过非聚集索引树就能直接找到数据的地址了，不需要回表，这比innodb的搜索效率会更高。
###  聚集索引和非聚集索引

1. 非聚集索引的存储结构与前面是一样的，不同的是在叶子结点的数据部分存的不再是具体的数据，而数据的聚集索引的key。
   1. 通过非聚集索引查找的过程是先找到该索引key对应的聚集索引的key，然后再拿聚集索引的key到主键索引树上查找对应的数据，这个过程称为回表 
   2. 使用 innodb 引擎需要回表

## 索引优化

1. like的模糊查询以%开头，会导致索引失效。
2. 一个表建的索引尽量不要超过5个。
3. 尽量使用覆盖索引。
4. 尽量不要在重复数据多的列上建索引