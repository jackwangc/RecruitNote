# 网络知识汇总

## 浏览网页的原理

1. 客户端浏览器通过DNS解析到www.baidu.com的IP地址220.181.27.48，通过这个IP地址找到客户端到服务器的路径。客户端浏览器发起一个HTTP会话到220.161.27.48，然后通过TCP进行封装数据包，输入到网络层。

2. 在客户端的传输层，把HTTP会话请求分成报文段，添加源和目的端口，如服务器使用80端口监听客户端的请求，客户端由系统随机选择一个端口如5000，与服务器进行交换，服务器把相应的请求返回给客户端的5000端口。然后使用IP层的IP地址查找目的端。

3. 客户端的网络层不用关心应用层或者传输层的东西，主要做的是通过查找路由表确定如何到达服务器，期间可能经过多个路由器，这些都是由路由器来完成的工作，我不作过多的描述，无非就是通过查找路由表决定通过那个路径到达服务器。

4. 客户端的链路层，包通过链路层发送到路由器，通过邻居协议查找给定IP地址的MAC地址，然后发送ARP请求查找目的地址，如果得到回应后就可以使用ARP的请求应答交换的IP数据包现在就可以传输了，然后发送IP数据包到达服务器的地址

## 网络模型

- OSI七层模型
    
    物理层、数据链路层、网络层、传输层、会话层、表示层、应用层。

- TCP/IP四层协议

    网络接口层、 网际层、运输层、 应用层。

- TCP/IP五层协议

    物理层、数据链路层、网络层、运输层、 应用层

- 网络层常见设备和协议
    
    协议：ip协议(因特网互联协议)，arp协议(地址解析)
    设备：路由器

- 传输层

    协议：tcp(传输控制协议)和udp(用户数据报协议)
    设备：网关

- 应用层

    协议：FTP、DNS、Telnet、SMTP、HTTP、WWW、NFS

## tcp 和 udp

## socket

## dns ip


## http 和 https

### http

> HTTP协议全称Hyper Text Transfer Protocol，翻译过来就是超文本传输协议，位于TCP/IP四层模型当中的应用层。默认80端口

1. 传输层的TCP是基于网络层的IP协议的，而应用层的HTTP协议又是基于传输层的TCP协议的，而Socket本身不算是协议，就像上面所说，它只是提供了一个针对TCP或者UDP编程的接口。
2. HTTP协议通过请求/响应的方式，在客户端和服务端之间进行通信
3. HTTP协议的信息传输完全以明文方式，不做任何加密，相当于是在网络上“裸奔”

#### http 请求过程

1. 客户端连接到 Web 服务器
    1. 一个 HTTP 客户端， 通常是浏览器， 与 Web 服务器的 HTTP 端口（默认为 80） 建立一个 TCP 套接字连接。 例如， http://www.oakcms.cn。
2. 发送 HTTP 请求
    1. 通过 TCP 套接字， 客户端向 Web 服务器发送一个文本的请求报文， 一个请求报文由请求行.   请求头部.   空行和请求数据 4 部分组成。
3. 服务器接受请求并返回 HTTP 响应
    1. Web 服务器解析请求， 定位请求资源。 服务器将资源复本写到 TCP 套接字， 由客户端读取。 一个响应由状态行.   响应头部.   空行和响应数据 4 部分组成。
4. 释放连接 TCP 连接
   1. 若 connection 模式为 close， 则服务器主动关闭 TCP 连接， 客户端被动关闭连接，释放 TCP 连接;若 connection 模式为 keepalive， 则该连接会保持一段时间， 在该时间内可以继续接收请求;
5. 客户端浏览器解析 HTML 内容

#### 对称加密方式

> 对称加密方式，并且约定一个随机生成的密钥。后续的通信中，信息发送方都使用密钥对信息加密，而信息接收方通过同样的密钥对信息解密。

> 但是第一次约定加密方式和密钥的通信仍然是明文，如果第一次通信就已经被拦截了，那么密钥就会泄露给中间人，中间人仍然可以解密后续所有的通信内容。

1. 服务端把加密方式和密钥传递给客户端(加密方式和密钥是明文)
2. 客户端接收加密信息
3. 加密通信明文，开始进行传递

#### 非对称加密

> 非对称加密，为密钥的传输做一层额外的保护。非对称加密的一组秘钥对中，包含一个公钥和一个私钥。明文既可以用公钥加密，用私钥解密；也可以用私钥加密，用公钥解密
 
1. 服务端和客户端建立通信，服务端首先把自己的公钥 Key1 发给客户端：
2. 接收到服务端公钥，客户端自己生成一个用于对称加密的密钥 Key2，并且用刚才接收的公钥 Key1 对 Key2 进行加密（这里有点绕），发送给服务端：
3. 服务端利用自己非对称加密的私钥，解开了公钥Key1的加密，获得了Key2的内容。从此以后，客户端和服务端就可以利用 Key2进行对称加密的通信了
4. 破解流程：
5. 截获服务端的公钥Key1，自己另外生成一对公钥私钥，
6. 把自己的公钥Key3发送给客户端。然后破解出客户端传递过来的 key2,
7. 利用key1 加密 key2,发送给服务端，中间人就可以解密信息

### https

> 引入第三方，一个权威的证书颁发机构（CA）来解决。证书一般包括证书颁发机构，服务端网址，服务端公钥（机构私钥加密），证书签名（机构私钥加密）

https 在 http 的基础上增加了 ssl 安全层，认证流程在 ssl 层中完成

1.  服务端把公钥 key1 发给证书办法机构，申请证书
2.  机构利用自己的私钥加密服务端公钥 key1
3.  通过服务端网址等信息生成证书签名，并通过私钥加密
4.  机构把证书发给服务端
5.  客户端请求通信，服务端将证书传给客户端
6.  客户端通过浏览器和操作系统找到本地的证书机构名称和机构的公钥
7.  解密证书签名
8.  客户端向机构请求生成证书签名，和本地接受证书签名比较
9.  证书签名一致，证书有效，利用机构公钥解密服务端公钥 key1
10. 利用公钥 key1 加密客户端生成的对称加密密钥 key2
11. 发送给服务端
12. 服务端通过 key1 的私钥解密，得到对称加密密钥 key2.
13. 客户端和服务端开始利用 key2 进行对称加密的通信









## session cookie

### cookie


---
## 参考链接

1. [小灰https](https://mp.weixin.qq.com/s/1ojSrhc9LZV8zlX6YblMtA)